@model List<ThanhToanTienNuoc.Models.ChiSoNuoc>
@{
    var user = ViewBag.NguoiDung as ThanhToanTienNuoc.Models.NguoiDung;
}

<h2 class="mb-4">Tìm kiếm người dùng</h2>

<!-- Form tìm kiếm -->
<form method="get" asp-action="TimKiem" class="row g-2 mb-3">
    <div class="col-md-8">
        <input type="text" name="keyword" value="@Context.Request.Query["keyword"]"
               class="form-control" placeholder="Nhập mã KH hoặc số điện thoại..." />
    </div>
    <div class="col-md-4 d-flex gap-2">
        <button type="submit" class="btn btn-primary flex-fill">🔍 Tìm kiếm</button>
        <a asp-action="TimKiem" class="btn btn-secondary flex-fill">⟲ Reset</a>
    </div>
</form>

@if (user != null)
{
    <h4 class="mt-4">Thông tin khách hàng</h4>
    <table class="table table-bordered">
        <tr><th>Mã KH</th><td>@user.MaKhachHang</td></tr>
        <tr><th>Họ tên</th><td>@user.HoTen</td></tr>
        <tr><th>Số điện thoại</th><td>@user.SoDienThoai</td></tr>
        <tr><th>Địa chỉ</th><td>@user.DiaChi?.TenXom</td></tr>
    </table>

    <h4 class="mt-4">Lịch sử chỉ số nước</h4>
    @if (Model != null && Model.Any())
    {
        <table class="table table-striped table-bordered align-middle">
            <thead class="table-light">
                <tr>
                    <th class="text-center">Năm</th>
                    <th class="text-center">Quý</th>
                    <th class="text-center">Chỉ số cũ</th>
                    <th class="text-center">Chỉ số mới</th>
                    <th class="text-center">Số thực dùng</th>
                    <th class="text-center">Thành tiền (đ)</th>
                    <th class="text-center">Thanh toán</th>
                    <th class="text-center">Ngày TT</th>
                    <th class="text-center">Hình thức TT</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var cs in Model)
                {
                    <tr>
                        <td class="text-center">@cs.Nam</td>
                        <td class="text-center">@cs.Quy</td>
                        <td class="text-center">@cs.ChiSoCu</td>
                        <td class="text-center">@cs.ChiSoMoi</td>
                        <td class="text-center">@cs.SoThucDung</td>
                        <td class="text-end">@cs.ThanhTien.ToString("N0")</td>
                        <td class="text-center">@cs.NgayThanhToan?.ToString("dd/MM/yyyy")</td>
                        <td class="text-center">@cs.HinhThucThanhToan</td>

                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <p class="text-muted">📭 Chưa có dữ liệu chỉ số nước.</p>
    }
}
else if (!string.IsNullOrWhiteSpace(Context.Request.Query["keyword"]))
{
    <p class="text-danger">❌ Không tìm thấy khách hàng nào.</p>
}
